var dploader;(function(){var a={version:"3.14.09.18"};function e(r,q){if(typeof r!=="string"){r=""+r}if(r.length===0||r.length>=q){return r}return"0000000000".slice(0,q-r.length)+r}function k(t){var w=t||"";if(w.length<=80){return w}var u=w.indexOf("?");if(u===-1){u=50}var v=w.indexOf("=");if(v===-1){v=50}var s=v<u?v:u;if(s>50){s=50}var r=w.length-10;if(s>=r){return w}w=w.slice(0,s)+" ... "+w.slice(r);return w}function l(q){var r=q||"";if(r.match(/^file\:\/\/\//i)){r=r.match(/[^\\\/]+?$/)}else{r=k(r)}return r}function j(q,r){return q.replace(/{([\w\$_]+)}/gm,function(s,t){return r[t]||s})}var m=null;function o(q){var r=new Date();return r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+"."+r.getMilliseconds()+": "+q}function g(r,q){return"["+e(r.sender.tab.id,2)+"."+e(r.portId_,3)+"] "+q}function c(r,s,q){return"["+e(r,2)+"."+e(s,3)+"] "+q}var b=(function(){var q={m_plugin:null,m_queue:[],m_failded:false,onbinmessage:null};q.getdpbin=function(){if(q.m_plugin){return q.m_plugin}q.m_plugin=document.getElementById("dpplugin");if(q.m_plugin&&!q.m_plugin.valid){q.m_plugin=null}q.m_plugin&&q.m_plugin.addEventListener("dpbin2js",function(r){q.onbinmessage&&q.onbinmessage(r)},false);q.m_plugin&&q.m_plugin.js2dpbin(b.getbinvermsg());return q.m_plugin};q.initComm=function(){var r=q.getdpbin();return r&&r.createcomm()};q.needErrorIcon=function(){var r=b.m_plugin===null&&b.m_queue.length>50;return r};q.tobin=function(s){if(b.m_failded){return}var r=b.getdpbin();if(!r){m&&m(o("DP plugin isn't loaded yet"));b.m_queue[b.m_queue.length]=JSON.stringify(s);if(b.m_queue.length>500){b.m_queue=[];b.m_failded=true}m&&m(o("Total pending = "+b.m_queue.length));return}r.js2dpbin(JSON.stringify(s))};q.onpluginloaded=function(){m&&m(o("DP plugin loaded now."));if(b.m_queue.length===0){return}m&&m(o("Were pending = "+b.m_queue.length));var s=b.getdpbin();for(var r=-1,t=b.m_queue.length;++r<t;){s.js2dpbin(b.m_queue[r])}b.m_queue=[]};q.sendactivated=function(r,s){b.tobin({what:"activated",data:{tabid:r,portid:s}})};q.getbinvermsg=function(){return JSON.stringify({what:"getbinver",data:{client:"chrome"}})};return q}());var f={m_visible:[],showDPMessage:function(q){if(q===-1||this.m_visible.indexOf(q)!==-1){return}this.m_visible.push(q);m&&m(o("@@@@@@@@ NEW icon for tab: "+q+" cnt: "+this.m_visible.length));chrome.pageAction.setIcon({tabId:q,path:"images/tooltip1L.png"});chrome.pageAction.setTitle({tabId:q,title:"click"});chrome.pageAction.setPopup({tabId:q,popup:"popup.html"});chrome.pageAction.show(q)},hideDPMessage:function(){if(!this.m_visible.length){return}chrome.windows.getAll({populate:true},function(q){var u,t,s,r;for(s=-1,ni=q.length;++s<ni;){u=q[s];for(r=-1,nj=u.tabs.length;++r<nj;){t=u.tabs[r];chrome.pageAction.hide(t.id)}}});this.m_visible=[]},onTabDestroyed:function(r){var q=this.m_visible.indexOf(r);if(q!==-1){this.m_visible.splice(q,1);m&&m(o("@@@@@@@@ DEL icon for tab: "+r+" cnt: "+this.m_visible.length))}}};function p(q){this.port=q;this.elements={};this.docsize={cx:0,cy:0}}p.prototype.findname=function(s){for(var q in this.elements){if(!this.elements.hasOwnProperty(q)){continue}var r=elements_[q];if(r.name===s){return r}}};p.prototype.addelements=function(r){for(var q in r){if(!r.hasOwnProperty(q)){continue}var s=r[q];this.elements[s.name]=s}this.sendtobinelements()};p.prototype.sendtobinelements=function(){var t={what:"pagecontent",data:{tabid:this.port.sender.tab.id,portid:this.port.portId_,url:this.port.name,fields:[],docx:this.docsize.cx,docy:this.docsize.cy}},r=t.data.fields,s;for(var q in this.elements){if(!this.elements.hasOwnProperty(q)){continue}s=this.elements[q];r[r.length]={hidx:s.hidx,name:s.name,type:s.type,vis:s.vis}}b.tobin(t)};function h(v,t){var w={what:"beforeunload",data:{tabid:v.sender.tab.id,portid:v.portId_,url:v.name,fields:[]}},r=w.data.fields,u=t.fields,s;for(var q in u){if(!u.hasOwnProperty(q)){continue}s=u[q];r[r.length]={hidx:s.hidx,name:s.name,type:s.type,vis:s.vis,disp:s.vidata.disp,val:s.vidata.val,vals:s.vidata.vals,chg:s.vidata.chg}}b.tobin(w)}p.prototype.sendtobinvalues=function(t){var v={what:"valuesready",data:{tabid:this.port.sender.tab.id,portid:this.port.portId_,url:this.port.name,fields:[],exdata:t.exdata}},r=v.data.fields,u=t.data.fields,s;for(var q in u){if(!u.hasOwnProperty(q)){continue}s=u[q];r[r.length]={name:s.name,disp:s.disp,val:s.val,vals:s.vals}}b.tobin(v)};p.prototype.onmenucommand=function(q){b.tobin({what:"iconmenucmd",data:{tabid:this.port.sender.tab.id,portid:this.port.portId_,menuid:q.menuid,fieldid:q.fieldid}})};p.prototype.sendtobinlayout=function(){var q={what:"layout",data:{tabid:this.port.sender.tab.id,portid:this.port.portId_,url:this.port.name,docx:this.docsize.cx,docy:this.docsize.cy}};b.tobin(q)};p.prototype.traceelements=function(){for(var q in this.elements){if(!this.elements.hasOwnProperty(q)){continue}var t=this.elements[q];var r="  ["+e(t.hidx,2)+"] type: "+t.type+", vis: "+t.vis+", name: '"+t.name+"'";m&&m(g(this.port,r))}};var i={m_pages:{},m_lastpostid:1,adddpage:function(s){if(!s.portId_){s.portId_=this.m_lastpostid++}var r=s.sender.tab.id,q=s.portId_;if(!this.m_pages[r]){m&&m(c(r,q,"NEW tab = "+r));this.m_pages[r]={}}this.m_pages[r][q]=new p(s)},deletepage:function(s,t){var u=this.m_pages[s];if(!u){return}if(u[t]){delete u[t]}var r=0;for(var q in u){if(u.hasOwnProperty(q)){r++;break}}if(r===0){delete this.m_pages[s];f.onTabDestroyed(s);m&&m(c(s,t,"DELETED tab = "+s))}},findpage:function(q){var s=this.m_pages[q.sender.tab.id],r=s&&s[q.portId_];return r},findportbyportid:function(r){var q;for(var t in this.m_pages){if(!this.m_pages.hasOwnProperty(t)){continue}q=this.m_pages[t];for(var s in q){if(!q.hasOwnProperty(s)){continue}if(q[s].port.portId_===r){return q[s].port}}}}};var n=(function(){return{oncsmessage:function(r,q){var s;switch(q.what){case"activated":b.sendactivated(r.sender.tab.id,r.portId_);break;case"layout":s=i.findpage(r);if(!s){return}if(!b.needErrorIcon()){f.hideDPMessage()}m&&m(g(r,"-=LAYOUT=- "+l(r.name)+" "+q.docsize.cx+"x"+q.docsize.cy));s.docsize=q.docsize;s.sendtobinlayout();break;case"fields":s=i.findpage(r);if(!s){return}s.docsize=q.docsize;s.addelements(q.elements);if(b.needErrorIcon()){f.showDPMessage(r.sender.tab.id)}m&&m(g(r,"ElementsOf "+l(r.name)));m&&s.traceelements();break;case"valsready":s=i.findpage(r);if(s){s.sendtobinvalues(q)}break;case"menucommand":case"barcommand":s=i.findpage(r);if(s){s.onmenucommand(q)}break;case"beforeunload":m&&m(g(r,"cstrace: beforeunload"));h(r,q);m&&m(g(r,"cstrace: beforeunload done"));break;case"bgtrace":m&&m(g(r,"cstrace: "+q.text));break}},ondpmessage:function(r){var q;switch(r.what){case"showicon":case"fingeract":case"senddata":case"showfbb":case"highlight":case"queryvals":q=i.findportbyportid(r.data.portid);n.tocs(q,r);break;case"binver":m&&m(o("binver: "+r.data.ver));break}},oncsconnect:function(q){if(!q.sender||!q.sender.tab){m&&m(c(-1,-1,"-=!!!!!!!!! NO TAB ATTACHED CS=- to '"+l(q.name)+"'"));return}i.adddpage(q);m&&m(g(q,"-=ATTACHED CS=- to '"+l(q.name)+"'"));q.onMessage.addListener(function(r){n.oncsmessage(q,r)});q.onDisconnect.addListener(function(){n.oncsdisconnect(q)});n.tocs(q,{what:"csid",data:{tabid:q.sender.tab.id,portid:q.portId_}})},oncsdisconnect:function(s){var r=s.sender.tab.id,q=s.portId_;m&&m(g(s,"portId["+e(q,2)+"], disconnected"));i.deletepage(r,q);b.tobin({what:"portstate",data:{tabid:r,portid:q,status:"destroy"}})},tocs:function(r,q){r&&r.postMessage(q)}}}());b.onbinmessage=function(q){n.ondpmessage(q)};chrome.extension.onConnect.addListener(function(q){n.oncsconnect(q)});function d(q){if(q===chrome.windows.WINDOW_ID_NONE){b.sendactivated(-1,-1);return}chrome.windows.getAll({populate:true},function(r){var v,u,t,s;for(t=-1,ni=r.length;++t<ni;){v=r[t];if(v.id!==q){continue}for(s=-1,nj=v.tabs.length;++s<nj;){u=v.tabs[s];if(!u.active){continue}b.sendactivated(u.id,-1);return}break}b.sendactivated(-2,-1)})}chrome.tabs.onActivated.addListener(function(q){b.sendactivated(q.tabId,-1)});chrome.windows.onFocusChanged.addListener(function(q){d(q)});chrome.windows.getCurrent(function(q){d(q.id)});dploader={onpluginloaded:function(){b.onpluginloaded()},onhtmlloaded:function(){}}})();